# 计算机网络的性能指标

> 多想想你做一件事情是谁得利，或许你就能看清一些表面热情实则漏洞百出的阴险交易。

1. **速率** ：指连接在计算机网络上的主机在数字信道上**传送数据的速率**，也被成为**比特率**，单位为b/s或bit/s（比特每秒）。

2. **带宽**：表示网络的通信线路所能传输数据的能力，也就是单位时间内从网络中某一点到另一点所能通过的**最高数据率**。带宽的单位是**比特每秒**，记为**b/s**。

3. **吞吐量**：单位时间内通过某个网络的数据量。

4. **时延**（delay或latency)：指数据从网络的一端传送到另一端所需的时间。网络中的时延往往是以下几个不同的时延组成：

   * **发送时延**（transmission delay）：是主机或路由器发送数据帧所需要的时间，也就是从发送数据帧的第一个比特算起，到改帧的最后一个比特发送完毕所需的时间。因此也称为**传输时延**，它的计算公式是：
     $$
     发送时延 = \frac {数据帧长度(bit)}{发送速率(bit/s)}
     $$
     由此可见，发送时延与发送帧长成正比，与**发送速率（每秒发送多少个比特）**成反比。

   * **传播时延**（propagation delay）：是电磁波在信道中传播一定距离需要花费的时间。计算公式为：
     $$
     传播时延 = \frac {信道长度(m)}{电磁波在信道上的传播速率(m/s)}
     $$
     **传播速率是指墨每秒传播了多少公里**。电磁波在真空中一光速传播，即$$3.0\times10^5km/s$$。在网络中传输稍慢，铜线中约为$$2.3\times10^5km/s$$，光纤中约为$$2.0\times10^5km/s$$。没错，光纤信道的传播速率比不上铜线，通常所说的"**光纤信道的传输速率高**"，**是指向光纤信道发送数据的速率可以很高而不是传播速率**。

     发送时延发生在机器内部的发送器中，区别于传播时延发生在机器外部的传输信道媒体上。

   * **处理时延**：主机或路由器在收到分组时要花费一定的时间进行处理，例如分析分组的首部、从分组中提取数据部分、进行差错检验或查找适当路由等。

   * **排队时延**：分组在经过网络传输时，要经过许多路由器。分组在进入路由器后要先在输入队列中排队等待处理。在路由器确定转发接口后，还要在输出队列中排队等待转发。这就产生了排队时延。

   所以，数据在网络中经历的总时延就是四种时延之和：

   $$总时延 = 发送时延 + 传播时延 + 处理时延 + 排队时延$$

   我们在优化时延时需要区分那个时延是主要因素。来看一个例子：

   如果要传送1个字节的数据（共8bit）。在1Mb/s的信道上的发送时延是$$8 \div 10^{6} = 8us$$，当传播时延为5ms时，不考虑其它时延，总时延为5.008ms。显然这种情况，传播时延决定了总时延，这是即使把数据率提高到1000倍，总时延也不会减少多少。

5. **时延带宽积**：把传播时延和带宽相乘就得到另一个度量：传播时延带宽积，即：

   $$时延带宽积 = 传播时延 \times 带宽$$

   如果将时延带宽积描述为一个长度是传播时延，横截面积是带宽的管道，那么时延带宽积就是这个管道的体积。假设某个链路的传播时延为20ms，带宽为10Mb/s。那么$$时延带宽积 = 20 \times 10 ^{-3} \times 10 \times 10^6 - 2 \times 10^5 bit$$。这表示如果发送端连续发送数据，则在发送的第一个比特即将到达终点时，发送端已经发送了20万个比特，而这20万个比特都正在链路上向前移动。对于一条正在传送数据的链路，只有在代表链路的管道都充满比特时，链路才能得到充分利用。

6. **往返时间**（RTT）：Round-Trip Time也是一个重要的性能指标，表示从发送方发送数据开始，到发送方收到来自接收方的确认（接收方收到数据后便立即发送确认），总共经历的时间。对于上述例子，往返时间是40ms，而往返时间和带宽的乘积是$$4 \times 10^5(bit)$$。

   往返时间和所发送分组的长度有关，发送很长的数据块的往返时间，应当比发送很短的数据块往返时间要多些。

   往返时间带宽积的意义是当发送方连续发送数据时，即使能够及时收到对方的确认，但已经将许多比特发送到链路上了。

7. **利用率**：利用率分为以下两种：

   * **信道利用率**：指某信道有百分之几的时间是被利用的（有数据通过）。完全空闲的信道利用率为零。
   * **网络利用率**：全网络信道利用率的加权平均值。

   信道利用率并非越高越好，因为根据排队理论，当某信道的利用率增大时，该信道引起的时延也就会迅速增加。在网络信号量不断增大的情况下，由于分组在网络节点（路由器或交换机）进行处理时需要排队等候，因此网络引起的时延就会增大。

   如果令$$D_0$$表示网络空闲时的时延，$$D$$表示网络当前的时延，在适当的假定条件下，可以用以下公式来表示当前时延和利用率之间的关系：

   $$ D = \frac {D_0} {1 - U}$$

   这里的$$U$$是网络的利用率，数值在0到1之间。当网络利用率达到其容量的$$\frac 1 2$$时，时延就会加倍。因此我们需要有这样的信念：**信道或网络利用率过高会产生非常大的时延。** 因此一些拥有较大主干网的ISP通常控制他们的信道利用率不超过50%。如果超过了，就准备扩容。下图是时延与利用率的关系。
   
   ![时延与利用率之间的关系](/Users/heli/github/ffmpeg-leaning/计算机网络/时延与利用率之间的关系.png)

# 计算机的网络体系结构

计算机网络的基础概念中，分层次的体系结构是最基本的。

## 分层结构的形成

链接在网络上的两台计算机需要互联，一条连通双方可以传递数据的通路是最基本的。其次还有如下工作需要完成。

1. 发起通信的计算机将数据通路**激活（activate）**。所谓激活就是发出一些指令，保证要传输的数据能在通路上被正确的发送和接收。
2. 告诉网络如何识别目标计算机。
3. 发起通信的计算机必须确定目标计算机是否处于可接受数据的状态（开机且网络链接正常）。
4. 发起通信的计算机的应用程序，必须弄清楚，目标计算机的文件管理程序是否做好文件接受和存储文件的准备工作。
5. 如果计算机文件格式不兼容，则至少其中的一个计算机应完成格式转换功能。
6. 对出现的各种差错和意外事故，如数据传输错误、重复或丢弃，网络中某个节点交换机出现故障等，应当有可靠的措施保证对方计算机最终能够收到正确的文件。
7. 其它

**分层**概念的提出，可以将上述庞大而复杂问题，转化为若干较小的局部问题，而这些较小的局部问题就比较易于研究和处理。

现在流行的**TCP/IP**是当前流行的分层协议，取代了**OSI**成为了事实上的国际标准。

## 协议与划分层次

在计算机网络中要做到有条不紊地交换数据，必须遵守一些事先约定好的规则。这些规则明确规定了所交换数据的格式以及有关的同步问题（即在一定的条件下应当发生什么事件，如发送一个应答信息）。这些为进行网络中的数据交换而建立的规则、标准或约定称为**网络协议（network protocol）**，也可称之为协议。

## 具有五层协议的体系结构

**OSI**具有七层体系结构，概念清楚，理论也比较完整，但它复杂又不实用。**TCP/IP**是一个具有四层的体系结构，包含应用层、传输层、网际层（用于强调这一层是为了解决不同网络的互联问题）和网络接口层。不过从实质上讲，**TCP/IP**只有最上面的三层，因为最下面的网络接口层并没有什么具体内容。因此在学习计算机网络的原理时往往采取这种的办法，即综合**OS**和**TCP/IP**的优点，采用一种支由五层协议的体系结构。这样即简洁又能将概念阐述清楚。

![计算机网络体系结构](/Users/heli/github/ffmpeg-leaning/计算机网络/计算机网络体系结构.png)

* **应用层（application layer）**：应用层是体系结构中的最高层。应用层直接为用户的应用进程提供服务。应用层协议有很多，如支持万维网应用的**HTTP**协议，支持电子邮件的**SMTP**协议，支持文件传送的**FTP**协议等等。

* **传输层（transport layer）**：传输层的任务是负责向**两个主机中进程之间的通信**提供服务。由于一个主机可同时运行多个进程，因此运输层有复用和分用的功能。复用就是多个应用层进程同时使用下面的传输层服务，分用则是运输层把收到的信息分别交付给上面应用层中的相应程序。

  传输层主要使用以下两种协议：

  1. **传输控制协议TCP（Transmission Control Protocol）**：面向连接的，数据传输的单位时**报文段**（segment），能够提供可靠交付。
  2. **用户数据报协议UDP（User Datagram Protocol）**：无连接的，数据传输的单位是**用户数据报**，不保证提供任何可靠的交付，只能提供"**尽最大努力交付(best-effort delivery)**"。

* **网络层（network layer）**：