# 计算机网络的性能指标

> 多想想你做一件事情是谁得利，或许你就能看清一些表面热情实则漏洞百出的阴险交易。

1. **速率** ：指连接在计算机网络上的主机在数字信道上**传送数据的速率**，也被成为**比特率**，单位为b/s或bit/s（比特每秒）。

2. **带宽**：表示网络的通信线路所能传输数据的能力，也就是单位时间内从网络中某一点到另一点所能通过的**最高数据率**。带宽的单位是**比特每秒**，记为**b/s**。

3. **吞吐量**：单位时间内通过某个网络的数据量。

4. **时延**（delay或latency)：指数据从网络的一端传送到另一端所需的时间。网络中的时延往往是以下几个不同的时延组成：

   * **发送时延**（transmission delay）：是主机或路由器发送数据帧所需要的时间，也就是从发送数据帧的第一个比特算起，到改帧的最后一个比特发送完毕所需的时间。因此也称为**传输时延**，它的计算公式是：
     $$
     发送时延 = \frac {数据帧长度(bit)}{发送速率(bit/s)}
     $$
     由此可见，发送时延与发送帧长成正比，与**发送速率（每秒发送多少个比特）**成反比。

   * **传播时延**（propagation delay）：是电磁波在信道中传播一定距离需要花费的时间。计算公式为：
     $$
     传播时延 = \frac {信道长度(m)}{电磁波在信道上的传播速率(m/s)}
     $$
     **传播速率是指墨每秒传播了多少公里**。电磁波在真空中一光速传播，即$$3.0\times10^5km/s$$。在网络中传输稍慢，铜线中约为$$2.3\times10^5km/s$$，光纤中约为$$2.0\times10^5km/s$$。没错，光纤信道的传播速率比不上铜线，通常所说的"**光纤信道的传输速率高**"，**是指向光纤信道发送数据的速率可以很高而不是传播速率**。

     发送时延发生在机器内部的发送器中，区别于传播时延发生在机器外部的传输信道媒体上。

   * **处理时延**：主机或路由器在收到分组时要花费一定的时间进行处理，例如分析分组的首部、从分组中提取数据部分、进行差错检验或查找适当路由等。

   * **排队时延**：分组在经过网络传输时，要经过许多路由器。分组在进入路由器后要先在输入队列中排队等待处理。在路由器确定转发接口后，还要在输出队列中排队等待转发。这就产生了排队时延。

   所以，数据在网络中经历的总时延就是四种时延之和：

   $$总时延 = 发送时延 + 传播时延 + 处理时延 + 排队时延$$

   我们在优化时延时需要区分那个时延是主要因素。来看一个例子：

   如果要传送1个字节的数据（共8bit）。在1Mb/s的信道上的发送时延是$$8 \div 10^{6} = 8us$$，当传播时延为5ms时，不考虑其它时延，总时延为5.008ms。显然这种情况，传播时延决定了总时延，这是即使把数据率提高到1000倍，总时延也不会减少多少。

5. **时延带宽积**：把传播时延和带宽相乘就得到另一个度量：传播时延带宽积，即：

   $$时延带宽积 = 传播时延 \times 带宽$$

   如果将时延带宽积描述为一个长度是传播时延，横截面积是带宽的管道，那么时延带宽积就是这个管道的体积。假设某个链路的传播时延为20ms，带宽为10Mb/s。那么$$时延带宽积 = 20 \times 10 ^{-3} \times 10 \times 10^6 - 2 \times 10^5 bit$$。这表示如果发送端连续发送数据，则在发送的第一个比特即将到达终点时，发送端已经发送了20万个比特，而这20万个比特都正在链路上向前移动。对于一条正在传送数据的链路，只有在代表链路的管道都充满比特时，链路才能得到充分利用。

6. **往返时间**（RTT）：Round-Trip Time也是一个重要的性能指标，表示从发送方发送数据开始，到发送方收到来自接收方的确认（接收方收到数据后便立即发送确认），总共经历的时间。对于上述例子，往返时间是40ms，而往返时间和带宽的乘积是$$4 \times 10^5(bit)$$。

   往返时间和所发送分组的长度有关，发送很长的数据块的往返时间，应当比发送很短的数据块往返时间要多些。

   往返时间带宽积的意义是当发送方连续发送数据时，即使能够及时收到对方的确认，但已经将许多比特发送到链路上了。

7. **利用率**：利用率分为以下两种：

   * **信道利用率**：指某信道有百分之几的时间是被利用的（有数据通过）。完全空闲的信道利用率为零。
   * **网络利用率**：全网络信道利用率的加权平均值。

   信道利用率并非越高越好，因为根据排队理论，当某信道的利用率增大时，该信道引起的时延也就会迅速增加。在网络信号量不断增大的情况下，由于分组在网络节点（路由器或交换机）进行处理时需要排队等候，因此网络引起的时延就会增大。

   如果令$$D_0$$表示网络空闲时的时延，$$D$$表示网络当前的时延，在适当的假定条件下，可以用以下公式来表示当前时延和利用率之间的关系：

   $$ D = \frac {D_0} {1 - U}$$

   这里的$$U$$是网络的利用率，数值在0到1之间。当网络利用率达到其容量的$$\frac 1 2$$时，时延就会加倍。因此我们需要有这样的信念：**信道或网络利用率过高会产生非常大的时延。** 因此一些拥有较大主干网的ISP通常控制他们的信道利用率不超过50%。如果超过了，就准备扩容。下图是时延与利用率的关系。